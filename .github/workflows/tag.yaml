name: Add Asset to Existing Release

on:
  push:
    tags:
      - 'v*'  # 태그를 푸시할 때 릴리즈에 추가

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - name: Check out the repository
      uses: actions/checkout@v4

    - name: Compress the directory
      run: |
        mkdir -p artifacts
        zip -r artifacts/rm2k-lostsaga.zip rm2k-lostsaga
    - name: Get the release upload URL for the existing release
      id: get_release
      uses: actions/github-script@v6
      with:
        script: |
          const tagName = '${{ github.ref_name }}';
          const { data: releases } = await github.rest.repos.listReleases({
            owner: context.repo.owner,
            repo: context.repo.repo,
          });
          
          const release = releases.find(release => release.tag_name === tagName);
          if (!release) {
            throw new Error(`Release with tag ${tagName} not found.`);
          }
          return release.upload_url.replace('{?name,label}', '');

    - name: Upload asset to the existing release
      uses: actions/upload-release-asset@v1
      with:
        upload_url: ${{ steps.get_release.outputs.result }}
        asset_path: artifacts/rm2k-lostsaga.zip
        asset_name: rm2k-lostsaga.zip
        asset_content_type: application/zip
